# K-YAYO 프로젝트 메모

## 개요 1. 기본 요구사항

- 진행은 한국어로 합니다.
- 사이트와 앱은 기본언어가 영어로 구성합니다.
- 항상 memo.md를 읽고 작업을 합니다.
- 진행하면서 변경되는 사항들은 task.md에 저장을 합니다.
- 주기적으로 깃허브에 저장을 하여서, 문제가 생겼을 때 돌아갈 수 있도록 합니다.
- PWA를 만들고, 핸드폰 기능을 중심으로 만들고, 타블렛과 PC버전도 고려를 한다.

## 개요 2. 프로젝트 개요

### 프로젝트 취지 및 목표

K-YAYO 개발 프로젝트는 **Next.js 기반의 프로그레시브 웹 앱(PWA)**으로, 한국 문화 및 엔터테인먼트 관련 게시글을 전 세계 사용자들이 언어 장벽 없이 공유하고, 소통할 수 있는 커뮤니티 플랫폼을 구축하는 것을 핵심 취지로 합니다. 특히, 젊은 세대, 그중에서도 젊은 여성을 주요 대상으로 하여 한국 케이팝 분위기를 지향합니다.

### 주요 목표

- K-Info, K-Culture, K-Enter, K-Promo, K-ACTOR, K-POP, K-Blogs의 내비게이션으로 다양한 게시판과 블로그에서 정보 공유와 대화를 할 수 있게 만든다.
- 글작성 등을 통해서 포인트를 얻고, 포인트를 사용하면서 참여를 유도한다.
- 다국어 소통 지원: 50개국어 지원을 통해 전 세계 사용자가 언어 장벽 없이 소통할 수 있도록 합니다.

## 진행 1. UI/UX 및 기술 스택

### 1-1. 헤더 구조

- **고정 헤더**: 모든 페이지에서 상단 헤더가 고정되어야 합니다.
- **2줄 구성**:
  - 첫줄: 왼쪽에 홈버튼, 뒤로가기 버튼, 가운데 제목(나중에 로고 삽입), 오른쪽 언어선택, 햄버거메뉴, 로그인표시
  - 두번째줄: 7개의 내비게이션 메뉴 (게시판 형식 6개, 블로그 형식 1개)
- **조건부 표시**: 홈버튼과 뒤로가기는 메인 첫 화면에서는 안 보여야 하며, 다른 모든 페이지에서는 있어야 한다.

### 1-2. 홈페이지 최신글 목록

- **반응형 레이아웃**:
  - 핸드폰 버전: 가장 위에서부터 하나씩
  - 테블릿 버전: 가장 위에서부터 두개씩
  - PC 버전: 가장 위에서부터 4개씩
- **K-Blogs 섹션**: News, Event, Politic, Free Board 각각 1개씩 최신글 표시
- **Boards 섹션**: K-Info, K-Culture, K-Enter, K-Promo, K-ACTOR, K-POP 각각 1개씩 최신글 표시
- **최신글 카드**: 제목, 내용 미리보기, 작성자, 작성일, 섹션명 표시

### 1-3. 광고 시스템

- **광고 삽입**: 모든 페이지(관리자 페이지 제외)에 적절히 광고란이 삽입되어야 합니다.
- **게시판 형식**: 20개의 명단마다 사이에 광고가 위치
- **블로그 형식**: 5개마다 광고 삽입
- **상세페이지**: 제목, 내용이 있고, 그 밑에 길게 하나 있으면 된다.

### 1-4. 브레드크럼 내비게이션

- 상세페이지에서 현재 위치 경로 표시 (예: K-POP → Idole Woman → Blackpink)
- 클릭하면 해당 페이지로 이동

## 진행 2. 내비게이션과 그 하부구조

### 2-1. 게시판 형식의 구성

K-YAYO 웹앱의 게시판 구조는 3단계 계층으로 이루어져 있습니다:

- **카테고리(내비게이션 메뉴)** → **총 리스트(1차 하부 리스트)** → **상세 리스트(2차 하부 리스트)** → **상세 게시판**

#### 1차 하부 리스트 (총 리스트)

- 리스트만 제공되며, 게시판 기능이나 글쓰기 기능은 없습니다.

#### 2차 하부 리스트 (상세 리스트)

- 리스트만 제공되며, 게시판 기능이나 글쓰기 기능은 없습니다.
- `public/data/` 폴더 아래 각 내비게이션 폴더 내에 .txt 형식으로 저장된 파일들로부터 동적으로 불러와집니다.
- 영어(한국어) 형식(Blackpink(블랙핑크))으로 입력하면 자동으로 상세 리스트와 게시판이 생성됩니다.

#### 상세 게시판

- 2차 하부 리스트의 특정 항목을 클릭했을 때, 해당 항목의 전용 게시판이 열립니다.
- 이 곳에서 글 목록과 글쓰기 기능이 제공됩니다.

### 2-2. 각 내비게이션별 구조

#### K-Info

- **1차 하부 리스트**: History, Region, Tourism, Language, University, Architecture, International
- **2차 하부 리스트**: `public/data/k-info/` 폴더 내 각 .txt 파일에서 동적으로 로드

#### K-Culture

- **1차 하부 리스트**: Cuisine, Foods, Region, Tourism, Sports, Music
- **2차 하부 리스트**: `public/data/k-culture/` 폴더 내 각 .txt 파일에서 동적으로 로드

#### K-Enter

- **1차 하부 리스트**: Movie, Drama, Webtoon, Animation, Youtuber, Game
- **2차 하부 리스트**: `public/data/k-enter/` 폴더 내 각 .txt 파일에서 동적으로 로드

#### K-Promo

- **1차 하부 리스트**: Company, Doctor, Shopping
- **2차 하부 리스트**: `public/data/k-promo/` 폴더 내 각 .txt 파일에서 동적으로 로드

#### K-ACTOR

- **1차 하부 리스트**: Man, Woman
- **2차 하부 리스트**: `public/data/k-actor/` 폴더 내 각 .txt 파일에서 동적으로 로드

#### K-POP

- **1차 하부 리스트**: Idole man, Idole woman
- **2차 하부 리스트**: `public/data/k-pop/` 폴더 내 각 .txt 파일에서 동적으로 로드

### 2-3. 블로그 형식의 구성 (K-Blogs)

K-Blogs는 블로그 형식으로 1차 하부 리스트만 존재합니다:

- **News**: 소유자 및 전체 관리자만 글쓰기가 가능합니다. 모든 이가 댓글, 대댓글, 좋아요 가능
- **Politic**: 소유자 및 전체 관리자만 글쓰기가 가능합니다. 모든 이가 댓글, 대댓글, 좋아요 가능
- **Event**: 소유자 및 전체 관리자만 글쓰기가 가능합니다. 모든 이가 댓글, 대댓글, 좋아요 가능
- **Free Board**: 모든 사용자들이 글쓰기가 가능합니다. 모든 이가 댓글, 대댓글, 좋아요 가능

## 진행 3. 회원과 관리자 시스템

### 3-1. 로그인/회원가입

- **Firebase Authentication**: 구글, 직접 입력 방식의 로그인을 지원
- **로그인 상태**: 언제든 로그인, 로그아웃이 가능
- **권한 제한**: 글쓰기나 댓글 등 활동 시에 로그인한 사람만 가능하게 설계

### 3-2. 사용자 프로필

- **표시 정보**: 로그인 시 사용자의 아이디, 회원이름(1회 수정 가능), 회원 포인트 표시
- **권한 표시**: 소유자(OWNER), 전체 관리자(Total ADMIN), 내비게이션 관리자(Navi Admin), 채널 관리자(Channel Admin), 게시판 관리자(Board Admin), 일반 회원(Member)으로 표시
- **관리자 버튼**: 관리자 권한을 가진 사용자에게 "채널 관리" 버튼 표시

### 3-3. 관리자 시스템

#### 5단계 권한 시스템

1. **소유자(OWNER)**: 모든 권한을 가지며, 모든 관리자를 이메일 기준으로 임명 및 해지할 수 있고, 모든 글 삭제 권한
2. **전체 관리자(Total ADMIN)**: 본인과 소유자 외의 모든 관리자를 이메일 기준으로 임명 및 해지할 수 있으며, 모든 글 삭제 권한
3. **내비게이션 관리자(Navi Admin)**: 자신의 내비게이션 이하의 모든 권한을 가지며, 자신의 내비게이션 이하의 게시판 관리자를 임명/해지할 수 있고, 자신이 관리하는 내비게이션 안의 모든 글 삭제 권한
4. **채널 관리자(Channel Admin)**: 각각의 내비게이션 이하의 1차 하부리스트의 각각의 리스트당 관리자
5. **게시판 관리자(Board Admin)**: 각각의 내비게이션 이하의 1차 하부리스트 밑의 2차 하부리스트의 각각의 리스트당 게시판 관리자
6. **일반 회원(Member)**: 기본 사용자 권한

#### 관리자 페이지

- **단일 관리자 대시보드**: 사용자 권한에 따라 동적으로 렌더링
- **관리자 활동 로그**: 모든 관리 활동을 기록하는 시스템
- **사용자 제재 기능**: 특정 사용자를 임시/영구적으로 글쓰기, 댓글 작성을 금지
- **API 사용 통계**: 소유자와 전체 관리자에게만 보여지는 외부 번역 API 사용량 통계
  소유자나 전체관리자가 권한을 줄때
  네비게이션 ,채널관리자,게시판 관리자를 정하는데..

방금 너가...게시판 관리자 바꾼 폼을 보니까..좋은 아이디어가 떠 올랐어
전체 관리자 들은
내비게이션 관리자에게 권한을 줄때..
내비게이션 관리를 클릭하면 내비게이션 중 하나를 선택하게 하고, 그 네비게이션만 관리하게 한다.
채널 관리자에게 권한을 주려면...내비게이션을 선택 후..그 하부의 채널을 선택하게 하여서 그것만 관리하게 하고
게시판 관리자에게 권한을 주려면..내비게이션에서 선틱후..그 하부의 채널을 선택하게 하고...그 하부의 상세리트 중에서 선택하게 하고,그 게시판만 관리하게 만들어야 한다.

## 진행 4. 포인트 시스템

### 4-1. 포인트 적립

- **글 작성**: 첫 10개까지는 건당 0.1점, 이후부터는 건당 0.05점
- **댓글 작성**: 첫 10개까지는 건당 0.05점, 이후부터는 건당 0.03점
- **대댓글 작성**: 첫 10개까지는 건당 0.02점, 이후부터는 건당 0.01점
- **좋아요/싫어요**: 글 작성자는 좋아요 100개 이상이면 1점, 싫어요 -100개당 1점씩 차감
- **악용 방지**: 본인이 작성한 글에 댓글이나, 대댓글, 좋아요, 싫어요를 다는 것에는 포인트 적립이 없음

### 4-2. 관리자 지급

- **소유자/전체 관리자**: 모든 사용자에게 무제한 지급 가능
- **방식**: 이메일로 포인트를 더해주거나, 빼는 기능
- **표시**: 포인트는 로그인 표시 하단에 레벨 표시와 포인트가 표시 (본인과 관리자들만 볼 수 있음)

### 4-3. 회원 등급

- **새싹멤버(0-4.999)**: 기본 등급-초록 잎새
- **일반멤버(5-29.999)**: 회색왕관
- **성실멤버(30-59.999)**: 노란왕관
- **열심멤버(60-99.999)**: 실버왕관
- **우수멤버(100-199.999)**: 골드왕관
- **최고멤버(200-499.999)**: 번쩍번쩍왕관
- **감사멤버(포인트 상관없이)**: 빨간 이파리 (다른 멤버 표시 오른쪽에 추가 표시)

### 4-4. 관리자 지팡이 색상

- **소유자**: 금색 (#FFD700)
- **전체 관리자**: 은색 (#C0C0C0)
- **내비게이션 관리자**: 청동 (#CD7F32)
- **채널 관리자**: 녹색 (#008000)
- **게시판 관리자**: 회색 (#808080)

### 4-5. 포인트 사용

- **포인트 클릭**: 포인트의 점수 상황과 점수를 가지고 사용 가능한 상점이나 리스트 표시
- **닉네임 변경**: 10점 소모

## 진행 5. 번역 시스템

## 진행 6. 햄버거 메뉴 시스템

### 6-1. 햄버거 메뉴 구조

햄버거 메뉴는 사용자 편의를 위한 주요 기능들을 제공합니다:

- **개인정보 관리**:

  - Edit Profile: 프로필 편집
  - Email Verification: 이메일 인증
  - Change Password: 비밀번호 변경
  - Delete Account: 계정 삭제 (빨간색으로 표시)

- **알림 설정**:

  - Ad Notifications: 광고 알림 설정
  - Email Notifications: 이메일 알림 설정

- **포인트 시스템**:

  - Point Shop: 포인트 상점
  - Recharge Points: 포인트 충전
  - Transaction History: 거래 내역

- **고객 지원**:

  - Send Feedback: 피드백 전송
  - Contact Support: 고객 지원

- **법적 페이지**:
  - Terms of Service: 이용약관
  - Privacy Policy: 개인정보처리방침
  - Legal Notices: 법적 고지

### 6-2. 메뉴 동작 방식

- **직접 네비게이션**: 서브메뉴 없이 각 버튼 클릭 시 바로 해당 페이지로 이동
- **자동 메뉴 닫기**: 페이지 이동 시 자동으로 햄버거 메뉴 닫기
- **이벤트 전파 방지**: 클릭 이벤트 충돌 방지를 위한 `e.stopPropagation()` 적용

## 진행 7. 사용자 설정 및 지원 시스템

### 7-1. 계정 관리

- **계정 삭제**:
  - 계정 정보 표시 (이메일, 닉네임, 포인트, 가입일)
  - 삭제될 데이터 목록 표시
  - "DELETE" 입력 확인 절차
  - Firebase Auth 및 Firestore 데이터 완전 삭제

### 7-2. 알림 설정

- **광고 알림 설정**:

  - 푸시 알림, 이메일 알림, 앱 내 알림 설정
  - 마케팅 알림, 일일/주간 다이제스트 설정

- **이메일 알림 설정**:
  - 콘텐츠 알림 (새 글, 댓글, 답글, 좋아요, 멘션)
  - 시스템 알림 (시스템 업데이트, 보안 알림, 뉴스레터)

### 7-3. 고객 지원

- **연락처 정보**:

  - 이메일: info@k-yayo.com
  - 전화: +33 6 0701 0336
  - 지원 시간: 월-금 9AM-6PM KST

- **지원 요청 시스템**:
  - 이슈 카테고리 선택 (기술적 문제, 계정 문제, 결제, 콘텐츠, 기능 요청 등)
  - 지원 요청 폼 (제목, 메시지, 사용자 정보 자동 포함)

### 7-4. 법적 페이지

- **이용약관**: 서비스 이용 조건, 사용자 행동 규칙, 지적재산권, 책임 제한
- **개인정보처리방침**: 수집하는 정보, 정보 사용 목적, 정보 공유 정책, 사용자 권리
- **법적 고지**: 저작권 고지, 상표권 고지, 면책 조항, DMCA 고지

## 진행 8. 번역 시스템

### 5-1. 정적 번역

- **기본 설정**: 전체 영어로 된 UI/UX의 모든 단어를 49개국 언어로 번역하여 JSON으로 저장
- **비용 절감**: 정적 번역을 통해 번역 비용 절감

### 5-2. 동적 번역

- **사용자 생성 콘텐츠**: 사람들이 작성된 글이나 블로그는 동적 번역
- **3단계 Fallback API 시스템**:
  1. MyMemory API (무료, 90% 사용하면 자동 패스)
  2. Lingva API (무료, 90% 사용하면 자동 패스)
  3. Google Translate API
- **스마트 캐싱**: 메모리 및 로컬 스토리지 캐싱을 통해 번역 결과를 더 빠르게 제공

### 5-3. 선택적 번역 시스템

- **텍스트 선택**: 마우스나 손가락으로 작성한 글 전체를 터치하면 복사하기, 번역하기 버튼 생성
- **복사하기**: 문단이 선택 복사
- **번역하기**: 문단 전체가 사용자의 언어에 따라 번역 API를 통해 해당 언어로 번역
- **상태 복원**: 페이지를 나가면 원상태로 돌아감

## 진행 6. 게시판 및 댓글 시스템

### 6-1. 게시글 시스템

- **CRUD 기능**: 생성, 읽기, 수정, 삭제 기능
- **Firestore 연동**: `posts` 컬렉션을 사용하여 게시글 데이터 저장
- **실시간 업데이트**: `onSnapshot`을 사용하여 실시간 업데이트 구현

### 6-2. 댓글 및 대댓글 시스템

- **계층 구조**: 재귀적으로 댓글과 대댓글을 표시하는 구조
- **실시간 업데이트**: 댓글/대댓글의 실시간 업데이트 기능
- **트랜잭션 기반**: Firestore 트랜잭션을 사용하여 데이터 정합성 보장
- **삭제 로직**: 대댓글이 있는 댓글 삭제 시, 부모 댓글과 모든 자식 대댓글을 함께 삭제

### 6-3. 좋아요/싫어요 시스템

- **토글 기능**: 사용자당 하나만 선택 가능하며, 반복 클릭 시 취소
- **상호 배타적**: 좋아요와 싫어요는 상호 배타적 (좋아요 클릭 시 싫어요 자동 취소)
- **트랜잭션 기반**: 데이터 정합성 보장

## 진행 7. 미디어 첨부 기능

### 7-1. 업로드 지원

- **이미지 업로드**: 최대 3장까지 이미지 첨부 가능
- **동영상 업로드**: 30초 이하 동영상 첨부 가능
- **첨부파일**: 다양한 형식의 파일 첨부 지원

### 7-2. 미디어 표시

- **이미지 갤러리**: 상세 페이지에서 이미지 갤러리 표시
- **동영상 플레이어**: 동영상 재생 기능
- **첨부파일 다운로드**: 파일 다운로드 기능

## 진행 8. 보안 시스템

### 8-1. 2FA 인증 시스템

- **목적**: 관리자 계정에 2단계 인증 추가로 보안 강화
- **구현 내용**:
  - Firebase Authentication과 연동된 2FA 시스템
  - TOTP (Time-based One-Time Password) 방식 사용
  - QR 코드를 통한 앱 연동 (Google Authenticator, Authy 등)
  - 백업 코드 생성 및 관리
  - 관리자 로그인 시 2FA 코드 입력 필드 추가
  - 2FA 설정/해제 기능 (관리자 프로필에서)

### 8-2. 추가 보안 강화 사항

- **IP 제한**: 특정 IP에서만 관리자 페이지 접근 허용
- **세션 관리**: 관리자 세션 타임아웃 설정
- **로그 기록**: 관리자 페이지 접근 및 활동 로그
- **환경 변수**: 관리자 계정 정보를 환경 변수로 관리

## 진행 9. PWA 및 SEO 최적화

### 9-1. PWA 핵심 기능

- **Service Worker 구현**: 오프라인 기능 및 캐싱
- **Web App Manifest 구현**: 앱 설치 및 홈 화면 추가
- **HTTPS 환경 설정**: 보안 연결
- **Lighthouse Audit**: 성능 최적화

### 9-2. SEO 최적화

- **메타데이터 설정**: 페이지별 메타 태그 설정
- **다국어 SEO**: 다국어 지원을 위한 SEO 최적화
- **사이트맵 생성**: 검색 엔진 크롤링 최적화

## 진행 10. 다음 단계 계획

### 10-1. 우선순위 높음

- 사용자 프로필 페이지 완성
- 게시글 수정 및 삭제 기능 구현
- 관리자 시스템 완전 구현 (5단계 권한 시스템)
- Firebase Storage 연동으로 실제 파일 업로드 구현

### 10-2. 우선순위 중간

- 번역 시스템 구현
- 2FA 인증 시스템 구현
- PWA 기능 완성
- SEO 최적화

### 10-3. 우선순위 낮음

- 추가 보안 기능
- 성능 최적화
- 사용자 경험 개선

## 진행 11. 최근 완료된 작업 (2024년 7월)

### 11-1. Vercel 배포 환경 문제 해결 ✅

- **Firebase 환경변수 설정**:
  - `.env.local` 파일 생성 및 Firebase 설정 추가
  - Vercel 환경변수 설정 가이드 제공
  - Firebase 설정 디버깅 로그 추가
- **구글 로그인 버튼 UI 개선**:
  - 흑백 색상을 진한 색상으로 변경하여 가시성 향상
  - 더 나은 사용자 경험 제공
- **Firebase Auth 에러 처리 개선**:
  - 구체적인 에러 메시지 제공 (팝업 차단, 인증되지 않은 도메인 등)
  - Firebase Auth 초기화 확인 로직 추가

### 11-2. 2차 하부리스트 로딩 문제 해결 ✅

- **서버사이드 → 클라이언트사이드 변경**:
  - `fs.readFileSync` → `fetch('/api/getBoardList')`로 변경
  - Vercel 배포 환경에서 정상 작동하도록 수정
- **API 라우트 구현**:
  - 서버사이드에서 정적 파일 읽기 및 JSON 응답
  - 에러 처리 및 로깅 개선
- **사용자 경험 개선**:
  - 로딩 상태: 스켈레톤 UI로 로딩 중 표시
  - 에러 처리: 파일 로드 실패 시 적절한 에러 메시지
  - 빈 상태: 데이터가 없을 때 안내 메시지

## 진행 12. 다음 단계 계획

### 12-1. 우선순위 높음

- [x] Vercel 배포 환경 문제 해결 (Firebase 설정, 구글 로그인)
- [x] 2차 하부리스트 로딩 문제 해결 (API 라우트 방식)
- [ ] Admin 페이지 접근 개선 (헤더에 Admin 링크 추가)
- [ ] 게시글 수정 및 삭제 기능 구현
- [ ] Firebase Storage 연동으로 실제 파일 업로드 구현

### 12-2. UI/UX 개선 계획

- ui/ux 의 디자인을 k-pop와 k-webtoon 분위기로 변경
- 랜딩 페이지 개선
- 햄버거 메뉴 클릭 시 기존 페이지가 검정색으로 변하는 것 수정
- 변경 사항이 생기면 ui/ux 의 언어 영어 임을 확인하고, 다국어 json의 번역본을 수정

### 12-3. 우선순위 중간

- 번역 시스템 구현
- 2FA 인증 시스템 구현
- PWA 기능 완성
- SEO 최적화

### 12-4. 우선순위 낮음

- 추가 보안 기능
- 성능 최적화
- 사용자 경험 개선

.env.local 파일이 없는게 아니라 있지만, 보안을 위해서 읽지 못하도록 되어있다. 존재한다.
